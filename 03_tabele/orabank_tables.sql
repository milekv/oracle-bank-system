
-- Plik: orabank_tables.sql
-- Cel: Tworzenie tabel systemu bankowego OraBank

-- =====================
-- Schemat BANK_CORE
-- =====================

-- Klienci banku
CREATE TABLE CLIENT (
    CLIENT_ID       NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    FIRST_NAME      VARCHAR2(50) NOT NULL,
    LAST_NAME       VARCHAR2(50) NOT NULL,
    PESEL           VARCHAR2(11) UNIQUE NOT NULL,
    DATE_OF_BIRTH   DATE NOT NULL,
    CREATED_AT      DATE DEFAULT SYSDATE,
    STATUS          VARCHAR2(20) DEFAULT 'AKTYWNY' NOT NULL
);

COMMENT ON TABLE CLIENT IS 'Klienci banku';
COMMENT ON COLUMN CLIENT.FIRST_NAME IS 'Imię klienta';
COMMENT ON COLUMN CLIENT.LAST_NAME IS 'Nazwisko klienta';
COMMENT ON COLUMN CLIENT.PESEL IS 'PESEL klienta';

-- Adresy klientów
CREATE TABLE CLIENT_ADDRESS (
    ADDRESS_ID      NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CLIENT_ID       NUMBER NOT NULL,
    STREET          VARCHAR2(100),
    CITY            VARCHAR2(50),
    POSTAL_CODE     VARCHAR2(10),
    COUNTRY         VARCHAR2(50),
    ADDRESS_TYPE    VARCHAR2(20),
    CONSTRAINT FK_CLIENT_ADDRESS FOREIGN KEY (CLIENT_ID) REFERENCES CLIENT(CLIENT_ID)
);

-- Dane kontaktowe
CREATE TABLE CLIENT_CONTACT (
    CONTACT_ID      NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CLIENT_ID       NUMBER NOT NULL,
    PHONE           VARCHAR2(20),
    EMAIL           VARCHAR2(50),
    CONTACT_TYPE    VARCHAR2(20),
    CONSTRAINT FK_CLIENT_CONTACT FOREIGN KEY (CLIENT_ID) REFERENCES CLIENT(CLIENT_ID)
);

-- Typy rachunków
CREATE TABLE ACCOUNT_TYPE (
    ACCOUNT_TYPE_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NAME            VARCHAR2(30) NOT NULL,
    DESCRIPTION     VARCHAR2(100)
);

-- Waluty
CREATE TABLE CURRENCY (
    CURRENCY_CODE   CHAR(3) PRIMARY KEY,
    NAME            VARCHAR2(50) NOT NULL,
    SYMBOL          VARCHAR2(5)
);

-- Rachunki bankowe
CREATE TABLE ACCOUNT (
    ACCOUNT_ID      NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CLIENT_ID       NUMBER NOT NULL,
    ACCOUNT_TYPE_ID NUMBER NOT NULL,
    CURRENCY_CODE   CHAR(3) NOT NULL,
    ACCOUNT_NUMBER  VARCHAR2(20) UNIQUE NOT NULL,
    BALANCE         NUMBER(15,2) DEFAULT 0,
    CREATED_AT      DATE DEFAULT SYSDATE,
    STATUS          VARCHAR2(20) DEFAULT 'AKTYWNY' NOT NULL,
    CONSTRAINT FK_ACCOUNT_CLIENT FOREIGN KEY (CLIENT_ID) REFERENCES CLIENT(CLIENT_ID),
    CONSTRAINT FK_ACCOUNT_TYPE FOREIGN KEY (ACCOUNT_TYPE_ID) REFERENCES ACCOUNT_TYPE(ACCOUNT_TYPE_ID),
    CONSTRAINT FK_ACCOUNT_CURRENCY FOREIGN KEY (CURRENCY_CODE) REFERENCES CURRENCY(CURRENCY_CODE)
);

-- Typy kart
CREATE TABLE CARD_TYPE (
    CARD_TYPE_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NAME         VARCHAR2(30) NOT NULL
);

-- Karty płatnicze
CREATE TABLE CARD (
    CARD_ID       NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ACCOUNT_ID    NUMBER NOT NULL,
    CARD_TYPE_ID  NUMBER NOT NULL,
    CARD_NUMBER   VARCHAR2(16) UNIQUE NOT NULL,
    EXPIRY_DATE   DATE NOT NULL,
    STATUS        VARCHAR2(20) DEFAULT 'AKTYWNA' NOT NULL,
    CONSTRAINT FK_CARD_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ACCOUNT_ID),
    CONSTRAINT FK_CARD_TYPE FOREIGN KEY (CARD_TYPE_ID) REFERENCES CARD_TYPE(CARD_TYPE_ID)
);

-- Kredyty
CREATE TABLE LOAN (
    LOAN_ID       NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ACCOUNT_ID    NUMBER NOT NULL,
    AMOUNT        NUMBER(15,2) NOT NULL,
    INTEREST_RATE NUMBER(5,2) NOT NULL,
    START_DATE    DATE NOT NULL,
    END_DATE      DATE NOT NULL,
    STATUS        VARCHAR2(20) DEFAULT 'AKTYWNY' NOT NULL,
    CONSTRAINT FK_LOAN_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ACCOUNT_ID)
);

-- Raty kredytu
CREATE TABLE LOAN_INSTALLMENT (
    INSTALLMENT_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    LOAN_ID        NUMBER NOT NULL,
    INSTALLMENT_DATE DATE NOT NULL,
    AMOUNT         NUMBER(15,2) NOT NULL,
    PAID_FLAG      CHAR(1) DEFAULT 'N',
    CONSTRAINT FK_INSTALLMENT_LOAN FOREIGN KEY (LOAN_ID) REFERENCES LOAN(LOAN_ID)
);

-- =====================
-- Schemat BANK_TX
-- =====================

-- Transakcje
CREATE TABLE TRANSACTION (
    TRANSACTION_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ACCOUNT_ID     NUMBER NOT NULL,
    TRANSACTION_DATE DATE DEFAULT SYSDATE,
    AMOUNT         NUMBER(15,2) NOT NULL,
    TRANSACTION_TYPE VARCHAR2(30) NOT NULL,
    DESCRIPTION    VARCHAR2(200),
    BALANCE_AFTER  NUMBER(15,2),
    CONSTRAINT FK_TRANSACTION_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ACCOUNT_ID)
);

-- Przelewy
CREATE TABLE TRANSFER (
    TRANSFER_ID    NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    TRANSACTION_ID NUMBER NOT NULL,
    TARGET_ACCOUNT VARCHAR2(20) NOT NULL,
    TITLE          VARCHAR2(200),
    CONSTRAINT FK_TRANSFER_TRANSACTION FOREIGN KEY (TRANSACTION_ID) REFERENCES TRANSACTION(TRANSACTION_ID)
);

-- Historia salda
CREATE TABLE BALANCE_HISTORY (
    HISTORY_ID   NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ACCOUNT_ID   NUMBER NOT NULL,
    BALANCE      NUMBER(15,2) NOT NULL,
    CHANGE_DATE  DATE DEFAULT SYSDATE,
    CONSTRAINT FK_BALANCE_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ACCOUNT_ID)
);

-- Blokady rachunku
CREATE TABLE ACCOUNT_BLOCK (
    BLOCK_ID     NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ACCOUNT_ID   NUMBER NOT NULL,
    AMOUNT       NUMBER(15,2) NOT NULL,
    REASON       VARCHAR2(200),
    CREATED_AT   DATE DEFAULT SYSDATE,
    RELEASED_AT  DATE,
    CONSTRAINT FK_BLOCK_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ACCOUNT_ID)
);

-- =====================
-- Schemat BANK_ADMIN
-- =====================

-- Logi audytu
CREATE TABLE AUDIT_LOG (
    AUDIT_ID     NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    TABLE_NAME   VARCHAR2(50) NOT NULL,
    RECORD_ID    NUMBER NOT NULL,
    OPERATION    VARCHAR2(20) NOT NULL,
    USER_NAME    VARCHAR2(50) NOT NULL,
    CHANGE_DATE  DATE DEFAULT SYSDATE
);

-- Logi błędów
CREATE TABLE ERROR_LOG (
    ERROR_ID     NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ERROR_CODE   VARCHAR2(20) NOT NULL,
    ERROR_MESSAGE VARCHAR2(4000) NOT NULL,
    CREATED_AT   DATE DEFAULT SYSDATE
);

-- Logi jobów
CREATE TABLE JOB_LOG (
    JOB_LOG_ID   NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    JOB_NAME     VARCHAR2(50) NOT NULL,
    START_TIME   DATE DEFAULT SYSDATE,
    END_TIME     DATE,
    STATUS       VARCHAR2(20)
);
